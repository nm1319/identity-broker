# Set up api in google
ClientID: 220422351180-jhuipb9b0a6kic1hmi0uv0c1cigahfgk.apps.googleusercontent.com

# Set up is done using below article as reference
# https://tyk.io/docs/advanced-configuration/integrate/api-auth-mode/oidc-auth0-example/

# Use https://openidconnect.net/ for the first few steps

# Step 1: Login to IDP (google) and authenticate yourself
https://accounts.google.com/o/oauth2/v2/auth?client_id=220422351180-jhuipb9b0a6kic1hmi0uv0c1cigahfgk.apps.googleusercontent.com&redirect_uri= https://openidconnect.net/callback&scope=openid profile email phone address&response_type=code&state=9103be5569b1cab6859c1128102a2381be16d7f9

# Step 2: Return Access code to callback/return URI and exchange access token and ID token
POST https://oauth2.googleapis.com/token
grant_type=authorization_code
&client_id=907336101912-18tltaf0k15t96evklf2huleha6oje77.apps.googleusercontent.com
&client_secret=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
&redirect_uri=https://openidconnect.net/callback
&code=4/0AfJohXl2Kdx9OFM1mMg3xCcDxPGt16xf68_mhJsYLr62B0BV-aJujhMtcx304472scY0-w

# Output of the above command is:
HTTP/1.1 200
Content-Type: application/json
{
  "access_token": "ya29.a0AfB_byAidSDI-OJRXOzdOetx2dBnSwNOc3w09jfO2tUPuJ3Q8AGyZrKDocaW15WWBpNUCL6zQkknrlnAl2bFktTv7Q4tACZRK2dpREfXdX6n_QPtvEANr2_CqG2mCvkSYd1nzXnVNWPCO6LwxgfIYXM9jCJoiDnh0OPyaCgYKAVASARISFQHGX2MifEvjR9clIR4KVUE5b0Fd_Q0171",
  "expires_in": 3599,
  "scope": "https://www.googleapis.com/auth/userinfo.profile openid https://www.googleapis.com/auth/userinfo.email",
  "token_type": "Bearer",
  "id_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImU0YWRmYjQzNmI5ZTE5N2UyZTExMDZhZjJjODQyMjg0ZTQ5ODZhZmYiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIyMjA0MjIzNTExODAtamh1aXBiOWIwYTZraWMxaG1pMHV2MGMxY2lnYWhmZ2suYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIyMjA0MjIzNTExODAtamh1aXBiOWIwYTZraWMxaG1pMHV2MGMxY2lnYWhmZ2suYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTQ2MDk2ODA5MDM1MDE5MTk3MzQiLCJlbWFpbCI6InByaW1lMTMxOUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXRfaGFzaCI6ImpfZ1dqYWFNY2VEdnVURmtoZVlXOWciLCJuYW1lIjoiTmlsYXkgTWVodGEiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jTFlCbkxJbWFmTktCNXlYMzNZaFdyR2RCdWhjclBWR2F3eElydmp1aDljPXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6Ik5pbGF5IiwiZmFtaWx5X25hbWUiOiJNZWh0YSIsImxvY2FsZSI6ImVuIiwiaWF0IjoxNzAxNzY4NTc0LCJleHAiOjE3MDE3NzIxNzR9.FvbHer9SPOjcq22w8O2p0gIqhnmRL-p8oJbTr1Ki5FhRIsUC5LpOscvPZF0hloyuQQu1s4rKu7vbF4Nda7izBAXgU2ej9h0xEZqWEywR3j0KrKuC0H1CYevlds7Nt8Gb7XTMKDVoIlrAD_GdNQemBvOK-do30zULMbd2MMTm9Cw0MP-qd7mjzTD2m3Iex9eMAV73YLNKJPxhk5vkCWDPVnlzHFlu7VkGWfHzYkF8HVNiCp5VSbhBxThqxld454zwX6ewxTKMwpxIvPKdAhefTmP8sOEym4GqNGDHIY1po7zBt5pPnYNfvfhD78q0feI92qHeInn5F2w8e_xuNBtVFw"
}

# Step 3: Tyk Gateway validates OIDC ID Token signature.
curl -X GET \
  http://localhost:8080/tyk-oidc/get \
  -H 'authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImU0YWRmYjQzNmI5ZTE5N2UyZTExMDZhZjJjODQyMjg0ZTQ5ODZhZmYiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIyMjA0MjIzNTExODAtamh1aXBiOWIwYTZraWMxaG1pMHV2MGMxY2lnYWhmZ2suYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIyMjA0MjIzNTExODAtamh1aXBiOWIwYTZraWMxaG1pMHV2MGMxY2lnYWhmZ2suYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTQ2MDk2ODA5MDM1MDE5MTk3MzQiLCJlbWFpbCI6InByaW1lMTMxOUBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiYXRfaGFzaCI6ImpfZ1dqYWFNY2VEdnVURmtoZVlXOWciLCJuYW1lIjoiTmlsYXkgTWVodGEiLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jTFlCbkxJbWFmTktCNXlYMzNZaFdyR2RCdWhjclBWR2F3eElydmp1aDljPXM5Ni1jIiwiZ2l2ZW5fbmFtZSI6Ik5pbGF5IiwiZmFtaWx5X25hbWUiOiJNZWh0YSIsImxvY2FsZSI6ImVuIiwiaWF0IjoxNzAxNzY4NTc0LCJleHAiOjE3MDE3NzIxNzR9.FvbHer9SPOjcq22w8O2p0gIqhnmRL-p8oJbTr1Ki5FhRIsUC5LpOscvPZF0hloyuQQu1s4rKu7vbF4Nda7izBAXgU2ej9h0xEZqWEywR3j0KrKuC0H1CYevlds7Nt8Gb7XTMKDVoIlrAD_GdNQemBvOK-do30zULMbd2MMTm9Cw0MP-qd7mjzTD2m3Iex9eMAV73YLNKJPxhk5vkCWDPVnlzHFlu7VkGWfHzYkF8HVNiCp5VSbhBxThqxld454zwX6ewxTKMwpxIvPKdAhefTmP8sOEym4GqNGDHIY1po7zBt5pPnYNfvfhD78q0feI92qHeInn5F2w8e_xuNBtVFw'

# Step 4: Tyk Gateway checks the IDP is a recognised IDP (registered as approved).

# Step 5: Tyk verifies the client ID as one that is trusted and pre-registered with the Tyk Gateway.



